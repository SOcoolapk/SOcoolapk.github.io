var searchFunc=function(e,t,a){"use strict";var r="<a id='local-search-close' style='float:right;margin-right:5px'><i class='fa fa-close'></i></a>",l=document.getElementById(t),n=document.getElementById(a);n.innerHTML=r+"<ul><span class='local-search-empty'><br>首次搜索，正在载入索引文件，请稍后……<br><br></span></ul>",$.ajax({url:e,dataType:"xml",success:function(e){var t=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get();n.innerHTML="",l.addEventListener("input",function(){var e='<ul class="search-result-list"><br>',a=this.value.trim().toLowerCase().split(/[\s\-]+/);if(n.innerHTML="",!(this.value.trim().length<=0)){if(t.forEach(function(t){var r=!0;t.title&&""!==t.title.trim()||(t.title="Untitled");var l=t.title.trim(),n=l.toLowerCase(),s=t.content.trim().replace(/<[^>]+>/g,""),c=s.toLowerCase(),i=t.url,u=-1,o=-1,h=-1;if(""!==c?a.forEach(function(e,t){u=n.indexOf(e),o=c.indexOf(e),u<0&&o<0?r=!1:(o<0&&(o=0),0==t&&(h=o))}):r=!1,r){e+="<li><a href='/"+i+"' class='search-result-title' target='_blank'>"+l+"</a>";var f=s;if(h>=0){var p=h-20,m=h+80;p<0&&(p=0),0==p&&(m=100),m>f.length&&(m=f.length);var d=f.substr(p,m);a.forEach(function(e){var t=new RegExp(e,"gi");d=d.replace(t,'<span class="search-keyword">'+e+"</span>")}),e+='<p class="search-result">'+d+"...</p>"}e+="</li>"}}),e+="</ul>",-1===e.indexOf("<li>"))return n.innerHTML=r+"<ul><span class='local-search-empty'><br>没有找到内容，请尝试更换检索词。<br><br></span></ul>";n.innerHTML=r+e}})}}),$(document).on("click","#local-search-close",function(){$("#local-search-input").val(""),$("#local-search-result").html("")})},getSearchFile=function(){searchFunc("/search.xml","local-search-input","local-search-result")};